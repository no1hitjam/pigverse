<html>
<head>

	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>PIGVERSE</title>
	<meta name="description" content="">
	<link rel="stylesheet" href="pico.css">
	<link rel="stylesheet" href="index.css">

</head>

<body>

	<br><br><br>

	<div class="content">

		<div class="canvasContainer">

			<canvas class="emscripten" id="canvas" oncontextmenu="event.preventDefault()"></canvas>

			<script type="text/javascript">
				var canvas = document.getElementById("canvas");
				canvas.width = window.innerWidth;
				canvas.height = window.innerHeight;

				// show Emscripten environment where the canvas is
				// arguments are passed to PICO-8
				
				var Module = {};
				Module.canvas = canvas;
			
				// When pico8_buttons is defined, PICO-8 takes each int to be a live bitfield
				// representing the state of each player's buttons
				
				var pico8_buttons = [0, 0, 0, 0, 0, 0, 0, 0]; // max 8 players
				//pico8_buttons[0] = 2 | 16; // example: player 0, RIGHT and Z held down
				
				// when pico8_gpio is defined, reading and writing to gpio pins will
				// read and write to these values
				var pico8_gpio = new Array(128);
				
			</script>

			<script async type="text/javascript" src="pico8comjs.js"></script> <!-- Add to your html container. -->
			<script async type="text/javascript" src="index.js"></script>
				
			<script>
				// key blocker. prevent cursor keys from scrolling page while playing cart.
				
				function onKeyDown_blocker(event) {
					event = event || window.event;
					var o = document.activeElement;
					if (!o || o == document.body || o.tagName == "canvas")
					{
						if ([32, 37, 38, 39, 40].indexOf(event.keyCode) > -1)
						{
							if (event.preventDefault) event.preventDefault();
						}
					}
				}

				document.addEventListener('keydown', onKeyDown_blocker, false);

			</script>
		</div>

		<div class="controllerContainer">
			<div class="controllerDirButtons">
				<div id="controllerUp" class="controllerDir"></div>
				<div id="controllerLeft" class="controllerDir"></div>
				<div id="controllerRight" class="controllerDir"></div>
				<div id="controllerDown" class="controllerDir"></div>
			</div>
			<div class="controllerActionButtons">
				<div id="controllerZ" class="controllerAction"></div>
				<div id="controllerX" class="controllerAction"></div>
			</div>
		</div>
	</div>
	<script type="text/javascript">
		function pressJoyButton(buttonIndex) {
			var newButtons = pico8_buttons[0] | 1 << buttonIndex;
			console.log("press: " + newButtons);
			pico8_buttons[0] = newButtons;
		}

		function releaseJoyButton(buttonIndex) {
			var newButtons = pico8_buttons[0] & (31 ^ 1 << buttonIndex);
			console.log("release: " + newButtons);
			pico8_buttons[0] = newButtons;
		}
		document.getElementById("controllerLeft").addEventListener("mousedown", () => pressJoyButton(0));
		document.getElementById("controllerLeft").addEventListener("mouseup", () => releaseJoyButton(0));
		document.getElementById("controllerRight").addEventListener("mousedown", () => pressJoyButton(1));
		document.getElementById("controllerRight").addEventListener("mouseup", () => releaseJoyButton(1));
		document.getElementById("controllerUp").addEventListener("mousedown", () => pressJoyButton(2));
		document.getElementById("controllerUp").addEventListener("mouseup", () => releaseJoyButton(2));
		document.getElementById("controllerDown").addEventListener("mousedown", () => pressJoyButton(3));
		document.getElementById("controllerDown").addEventListener("mouseup", () => releaseJoyButton(3));
		document.getElementById("controllerZ").addEventListener("mousedown", () => pressJoyButton(4));
		document.getElementById("controllerZ").addEventListener("mouseup", () => releaseJoyButton(4));
		document.getElementById("controllerX").addEventListener("mousedown", () => pressJoyButton(5));
		document.getElementById("controllerX").addEventListener("mouseup", () => releaseJoyButton(5));
	</script>

	<br><br>

</body></html>


